<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Caddy2å®‰è£…ä¸æ‰˜ç®¡é™æ€åšå®¢ -
    Wherelse Blog</title>
<meta name="ThemeName" content="Gridea Theme Rocky by EryouHao" />
<meta name="referrer" content="always" />
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<link rel="manifest" href="/site.webmanifest">
<!-- <link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet preload" as="style"> -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"> -->
<!-- <link rel="stylesheet" href="https://cdn.staticfile.org/animate.css/3.7.2/animate.min.css" as="style" /> -->
<link href="/media/css/remixicon.css" rel="stylesheet" as="style">
<link rel="stylesheet" href="/media/css/tailwind.css">
<link rel="stylesheet" href="/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Caddy2å®‰è£…ä¸æ‰˜ç®¡é™æ€åšå®¢ -
    Wherelse Blog - Atom Feed" href="/atom.xml">

  
  <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4449R7TQN5"></script>
  <script>
  var host = window.location.hostname;
  if(host != "localhost")
  {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4449R7TQN5');
  }
  </script>
    

  <!-- <title name="Caddy2å®‰è£…ä¸æ‰˜ç®¡é™æ€åšå®¢"> </title> -->
  <meta name="socialText" content="è®°å½•å­¦ä¹ ä¸æŠ˜è…¾ï¼Œç½‘ç»œï¼Œåšå®¢ï¼ŒåµŒå…¥å¼ç›¸å…³ï¼›Record learning and toss, network, blog, embedded related" />
  <meta name="description" content="Caddy2 installation and hosting of static blogs

Caddy2å®‰è£…
ä»¥ä¸‹æ“ä½œå‡ä¸ºubuntuç¯å¢ƒ
æºå®‰è£…(æ¨è)
sudo apt install -y debian-keyring debi..." />
  <meta name="referrer" content="always" />
  <link rel="canonical" href="https://wherelse.cc/post/Caddy2-installation-hosting-of-static-blogs/" />
  <link rel="preconnect" href="https://cdn.staticfile.org" />
  <script src="https://wherelse.cc/media/scripts/photoswipe.min.js"></script>
  <script src="https://wherelse.cc/media/scripts/photoswipe-ui-default.min.js"></script>
  <link rel="stylesheet" href="https://wherelse.cc/media/css/photoswipe.css" as="style" />
  <link rel="stylesheet" href="https://wherelse.cc/media/css/default-skin.css" as="style" />
  <!-- Code Highlight -->
  
  <script src="https://wherelse.cc/media/prism.js"></script>
  <script>
    Prism.highlightAll();
  </script>
  
  
  <link rel="stylesheet preload"
    href="https://wherelse.cc/media/css/prism-github.css"
    as="style" />
  
</head>

<body>
  <div class="antialiased flex flex-col min-h-screen" id="app">
    <a href="https://wherelse.cc"
      class="fixed top-0 left-0 mt-4 bg-black text-white dark:text-gray-700 dark:bg-yellow-50 dark:hover:bg-black dark:hover:text-white inline-flex p-2 pl-8 hover:text-gray-700 hover:bg-yellow-50 font-bold z-10 transition-fast animated fadeInLeft">
      Wherelse Blog
    </a>
    <div class="max-w-4xl w-full mx-auto">
      <div
        class="shadow-box bg-white dark:bg-gray-600 rounded-lg pt-32 md:pt-32 px-4 md:px-8 pb-8 animated fadeIn mb-8">
        <h1 class="text-5xl font-semibold leading-normal pb-8 mb-8 border-b-8 border-gray-700">
          Caddy2å®‰è£…ä¸æ‰˜ç®¡é™æ€åšå®¢
        </h1>
        
        <div class="mb-8 flex flex-wrap">
          <div class="text-gray-400 text-sm mr-4">
            2021-01-17 Â· 8 min read
          </div>
          
          <a href="https://wherelse.cc/tag/bVOkvqw2z/"
            class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
            <i class="ri-hashtag"></i>
            ç¬”è®°
          </a>
          
          <a href="https://wherelse.cc/tag/Hg2wOF7pj/"
            class="text-gray-700 text-sm border-b-2 border-dotted border-gray-200 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
            <i class="ri-hashtag"></i>
            ç½‘ç»œ
          </a>
          
        </div>
        <div class="markdown mb-16" v-pre>
          <p>Caddy2 installation and hosting of static blogs</p>
<!-- more -->
<h2 id="caddy2å®‰è£…">Caddy2å®‰è£…</h2>
<p>ä»¥ä¸‹æ“ä½œå‡ä¸ºubuntuç¯å¢ƒ</p>
<h3 id="æºå®‰è£…æ¨è">æºå®‰è£…(æ¨è)</h3>
<pre><code class="language-shell">sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https 
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/cfg/gpg/gpg.155B6D79CA56EA34.key' | sudo apt-key add -
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/cfg/setup/config.deb.txt?distro=debian&amp;version=any-version' | sudo tee -a /etc/apt/sources.list.d/caddy-stable.list
sudo apt update
sudo apt install caddy
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œåœ¨å‘½ä»¤çª—å£è¾“å…¥<code>caddy</code>ï¼Œå¯ä»¥æŸ¥çœ‹caddyç›¸å…³çš„å‘½ä»¤ã€‚</p>
<pre><code class="language-shell">usage:
 caddy &lt;command&gt; [&lt;args...&gt;]

commands:
 adapt           Adapts a configuration to Caddy's native JSON
 build-info      Prints information about this build
 environ         Prints the environment
 file-server     Spins up a production-ready file server
 fmt             Formats a Caddyfile
 hash-password   Hashes a password and writes base64
 help            Shows help for a Caddy subcommand
 list-modules    Lists the installed Caddy modules
 reload          Changes the config of the running Caddy instance
 reverse-proxy   A quick and production-ready reverse proxy
 run             Starts the Caddy process and blocks indefinitely
 start           Starts the Caddy process in the background and then returns
 stop            Gracefully stops a started Caddy process
 trust           Installs a CA certificate into local trust stores
 untrust         Untrusts a locally-trusted CA certificate
 validate        Tests whether a configuration file is valid
 version         Prints the version
</code></pre>
<h3 id="ä¸‹è½½å®‰è£…å¹¶æ‰‹åŠ¨æ³¨å†Œlinux-service">ä¸‹è½½å®‰è£…å¹¶æ‰‹åŠ¨æ³¨å†Œlinux service</h3>
<p>é¦–å…ˆåˆ°å®˜ç½‘ä¸‹è½½<a href="https://caddyserver.com/download">Caddy2</a>ï¼Œç„¶åå°†ä¸‹è½½çš„æ–‡ä»¶æ”¹åä¸ºcaddyåä¸Šä¼ è‡³æœåŠ¡å™¨ã€‚</p>
<pre><code class="language-shell">sudo mv caddy /usr/bin/
caddy version #æµ‹è¯•æ˜¯å¦æ­£å¸¸è¿è¡Œ
sudo groupadd --system caddy
sudo useradd --system \
    --gid caddy \
    --create-home \
    --home-dir /var/lib/caddy \
    --shell /usr/sbin/nologin \
    --comment &quot;Caddy web server&quot; \
    caddy
</code></pre>
<p>ä¸‹è½½<a href="https://github.com/caddyserver/dist/blob/master/init/caddy.service">caddy.service</a>æ–‡ä»¶ï¼Œå¹¶ç§»åŠ¨åˆ°<code>/etc/systemd/system/caddy.service</code>ã€‚ç„¶åå¯ä»¥é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤é…ç½®caddyè¿è¡ŒçŠ¶æ€ï¼š</p>
<pre><code class="language-shell">sudo systemctl daemon-reload #é‡è½½é…ç½®
sudo systemctl enable caddy    #å¯ç”¨caddy
sudo systemctl start caddy     #å¼€å¯caddy
sudo systemctl reload caddy     #åº”ç”¨æ‰€æœ‰é…ç½®æ–‡ä»¶ä¿®æ”¹
sudo systemctl status caddy     #æŸ¥çœ‹caddyçŠ¶æ€
sudo systemctl stop caddy       #åœæ­¢caddy
</code></pre>
<p>ä½¿ç”¨å®˜æ–¹æœåŠ¡æ–‡ä»¶æ—¶ï¼Œcaddyè¾“å‡ºå°†é‡å®šå‘åˆ°<code>journalctl</code></p>
<pre><code class="language-shell">journalctl -u caddy --no-pager | less
</code></pre>
<h2 id="ç¼–è¾‘é…ç½®æ–‡ä»¶">ç¼–è¾‘é…ç½®æ–‡ä»¶</h2>
<p>Caddy2ä¸Caddy1ä¸åŒï¼Œå¼€å§‹ä½¿ç”¨jsonä½œä¸ºé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥ä½¿ç”¨Caddyfileè¿›è¡Œé…ç½®ï¼Œåç»­å†…å®¹å‡ä½¿ç”¨Caddyfileã€‚é»˜è®¤Caddyfileè·¯å¾„ä¸º<code>/etc/caddy</code>ï¼Œä½¿ç”¨viæˆ–nanoç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œè‹¥æ— è¯¥æ–‡ä»¶åˆ™æ‰‹åŠ¨åˆ›å»ºã€‚</p>
<pre><code class="language-shell">cd /etc/caddy
touch Caddyfile #è‹¥ç›®å½•ä¸‹æ— é…ç½®æ–‡ä»¶
sudo nano Caddyfile
</code></pre>
<p>åœ¨é…ç½®æ–‡ä»¶å¡«å†™ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-yaml">your domain {
        root * /root/deploy #ä½ éœ€è¦å‘å¸ƒçš„æ–‡ä»¶è·¯å¾„
        file_server
}
</code></pre>
<p>è¿™æ ·ç½‘ç«™å°±å¯ä»¥è·‘èµ·æ¥äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰é…ç½® HTTPSï¼Œè‡ªåŠ¨çš„HTTPSæ˜¯ä¸ªäººä½¿ç”¨Caddyçš„æœ€å¤§ä¼˜åŠ¿ã€‚</p>
<h3 id="auto-https">Auto-HTTPS</h3>
<p>Caddyçš„Auto-HTTPSéªŒè¯æœ‰å‡ ç§æ–¹æ³•ï¼Œåˆ†ä¸ºHTTPéªŒè¯ã€TLS-ALPNéªŒè¯å’ŒDNSéªŒè¯ã€‚</p>
<h3 id="httpéªŒè¯ä¸tls-alpnéªŒè¯">HTTPéªŒè¯ä¸TLS-ALPNéªŒè¯</h3>
<p>è¿™ä¸¤ç§éªŒè¯æ–¹å¼åˆ†åˆ«éœ€è¦80ç«¯å£å’Œ443ç«¯å£æ²¡æœ‰è¢«å…¶ä»–æœåŠ¡å ç”¨ï¼Œå¯è¢«Caddyä½¿ç”¨ã€‚<br>
è¿™ä¸¤ç§éªŒè¯çš„é…ç½®æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œä»…éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š</p>
<pre><code class="language-yaml">tls xxxxx@xxx.com #ä½ çš„é‚®ç®±
</code></pre>
<p>å°±å¯ä»¥å®ç°è‡ªåŠ¨HTTPSã€‚<br>
é…ç½®å®Œæˆåçš„å®Œæ•´é…ç½®ï¼š</p>
<pre><code class="language-yaml">your domain {
        root * /root/deploy #ä½ éœ€è¦å‘å¸ƒçš„æ–‡ä»¶è·¯å¾„
        file_server
        tls xxxxx@xxx.com  #ä½ çš„é‚®ç®±
}
</code></pre>
<h3 id="dns-éªŒè¯">DNS éªŒè¯</h3>
<p>ä»¥Cloudflareä¸ºDNSæ‰˜ç®¡æœåŠ¡å•†ä¸ºä¾‹ã€‚é¦–å…ˆå»Cloudflareæ§åˆ¶å°,é€‰æ‹©<code>ç«™ç‚¹-&gt;è·å–æ‚¨çš„ API ä»¤ç‰Œ-&gt;APIä»¤ç‰Œ-&gt;åˆ›å»ºä»¤ç‰Œ-&gt;ç¼–è¾‘åŒºåŸŸDNS-&gt;ä½¿ç”¨æ¨¡æ¿</code>ï¼Œé€‰æ‹©ç›¸å…³é…ç½®åï¼Œåˆ›å»ºä»¤ç‰Œï¼Œå¤åˆ¶å¹¶è®°å½•ä»¤ç‰Œã€‚åœ¨Caddyfileçš„ç½‘ç«™é…ç½®ä¸­æ·»åŠ ä¸€ä¸‹è¯­å¥ã€‚</p>
<pre><code class="language-yaml">tls {
    dns cloudflare $your_token 
}
</code></pre>
<p>é…ç½®å®Œæˆåçš„å®Œæ•´é…ç½®ï¼š</p>
<pre><code class="language-yaml">your domain {
        root * /root/deploy #ä½ éœ€è¦å‘å¸ƒçš„æ–‡ä»¶è·¯å¾„
        file_server
        tls {
            dns cloudflare $your_token 
        }
}
</code></pre>
<p>Cloudflareçš„DNSéªŒè¯éœ€è¦Caddyçš„éªŒè¯æ’ä»¶ï¼Œè€Œæºå®‰è£…çš„ç‰ˆæœ¬æ˜¯ä¸å¸¦éªŒè¯æ’ä»¶çš„ï¼Œéœ€è¦å¯¹caddyæºæ–‡ä»¶è¿›è¡Œæ›¿æ¢ï¼Œé¦–å…ˆå»å®˜ç½‘ä¸‹è½½é¢„ç¼–è¯‘æ’ä»¶ç‰ˆæœ¬æºæ–‡ä»¶ï¼Œæ³¨æ„é€‰æ‹©æ’ä»¶ï¼Œè¿è¡Œå¹³å°åä¸‹è½½ã€‚<br>
<img src="https://wherelse.cc/post-images/1610935077456.jpg" alt="" loading="lazy"><br>
ä¸‹è½½åä¸Šä¼ è‡³æœåŠ¡å™¨ï¼Œå¹¶ç§»åŠ¨æºæ–‡ä»¶è‡³<code>/usr/bin/</code>ç›®å½•ä¸‹ã€‚</p>
<pre><code class="language-shell">sudo mv caddy /usr/bin/
chmod +x /usr/bin/caddy #èµ‹å¯æ‰§è¡Œæƒé™
</code></pre>
<p>é‡å¯Caddyï¼Œå¹¶è¿è¡Œ<code>caddy list-modules</code>ï¼ŒæŸ¥çœ‹æ’ä»¶æ˜¯å¦å·²åœ¨å·²å®‰è£…åˆ—è¡¨ä¸­ã€‚<br>
<img src="https://wherelse.cc/post-images/1610935520714.jpg" alt="" loading="lazy"><br>
è¿™é‡Œå°±å®Œæˆäº†åŸºäºDNSéªŒè¯çš„Auto-HTTPSçš„é…ç½®ã€‚<br>
<strong>å…³äºAuto-HTTPSæ›´è¯¦ç»†è¿›ä¸€æ­¥çš„é…ç½®å‚è€ƒè¯·å®˜æ–¹æ–‡æ¡£ã€‚</strong></p>
<h2 id="è¿›ä¸€æ­¥é…ç½®">è¿›ä¸€æ­¥é…ç½®</h2>
<p>Caddyfile æ”¯æŒç±»ä¼¼ä»£ç ä¸­å‡½æ•°ä¸€æ ·çš„é…ç½®ç‰‡æ®µï¼Œå¯ä»¥åœ¨ä»»æ„ä½ç½®è¢« importå¼•å…¥ï¼Œä¸”å¯ä»¥ä¼ é€’å‚æ•°ï¼Œä¸‹é¢åˆ†åˆ«é…ç½®ä¸€éƒ¨åˆ†é…ç½®ç‰‡æ®µã€‚<br>
<strong>å¯ç”¨HTHS</strong> ( HTTP Strict Transport Securityï¼ŒHTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ ), å®ƒå‘Šè¯‰æµè§ˆå™¨åªèƒ½é€šè¿‡HTTPSè®¿é—®å½“å‰èµ„æºï¼Œè€Œä¸æ˜¯HTTPï¼š</p>
<pre><code class="language-yaml;">(HSTS) {
    # HSTS (æœ€å¤§æ—¶é•¿63072000 seconds)
    header / Strict-Transport-Security &quot;max-age=63072000&quot;
}
</code></pre>
<p><strong>é”™è¯¯å¤„ç†</strong><br>
å¤„ç†404é”™è¯¯é¡µé¢ï¼ŒæŒ‡å‘ç½‘ç«™æ ¹ç›®å½•çš„404é¡µé¢ï¼š</p>
<pre><code class="language-yaml">(ERROR_HANDLE) {
        handle_errors {
                @404 {
                        expression {http.error.status_code} == 404
                }
                handle @404 {
                        rewrite * /404.html
                        file_server
                }
        }
}
</code></pre>
<p><strong>å¼€å¯å¹¶é…ç½®log</strong></p>
<pre><code class="language-yaml">(LOG) {
    log {
        output file &quot;{args.0}&quot; {
                roll_size     500MiB #æ»šåŠ¨å­˜å‚¨å¤§å°æœ€å¤§500MiB
                roll_local_time     #ä½¿ç”¨æœåŠ¡å™¨æœ¬åœ°æ—¶é—´
                roll_keep     20    #ä¿å­˜20ä¸ªç‰ˆæœ¬çš„æ»šåŠ¨log
                roll_keep_for 30d #æ»šåŠ¨ä¿å­˜æ—¶é•¿30å¤©
        }
    }
}
</code></pre>
<p>å…¶ä¸­<code>{args.0}</code>ä¸ºé€šè¿‡å‚æ•°ä¼ é€’çš„logæ–‡ä»¶åä¿¡æ¯ã€‚</p>
<p><strong>é…ç½®TLSä½¿å…¶æ›´å®‰å…¨</strong></p>
<pre><code class="language-yaml">(TLS_CONFIG) {
    # TLS é…ç½®é‡‡ç”¨ https://mozilla.github.io/server-side-tls/ssl-config-generator/ ç”Ÿæˆ
    # Due to a lack of DHE support, you -must- use an ECDSA cert to support IE 11 on Windows 7
    protocols tls1.2 tls1.3
    ciphers TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
}
</code></pre>
<p><strong>èšåˆä¸ºé€šç”¨é…ç½®</strong></p>
<pre><code class="language-yaml">(GENERAL_CONFIG) {
        # ä½¿ç”¨HTTPéªŒè¯æˆ–TLS-ALPNéªŒè¯
        tls xxxxxx@xxx.com {
            import TLS_CONFIG    
        }
        # HSTS
        import HSTS
        # å‹ç¼©æ”¯æŒ
        encode zstd gzip
        # é”™è¯¯å¤„ç†
        import ERROR_HANDLE
}
</code></pre>
<p><strong>é…ç½®å…¨å±€è®¾ç½®</strong><br>
å°è¯•åœ¨å…¨å±€è®¾ç½®ä¸­å¼€å¯HTTP3æ”¯æŒ</p>
<pre><code class="language-yaml">{
        servers :443 {
                protocol {
                                experimental_http3
                } 
        }
}
</code></pre>
<h2 id="å®Œå–„æœ€ç»ˆé…ç½®æ–‡ä»¶">å®Œå–„æœ€ç»ˆé…ç½®æ–‡ä»¶</h2>
<pre><code class="language-yaml">(TLS_CONFIG) {
    # TLS é…ç½®é‡‡ç”¨ https://mozilla.github.io/server-side-tls/ssl-config-generator/ ç”Ÿæˆ
    # Due to a lack of DHE support, you -must- use an ECDSA cert to support IE 11 on Windows 7
    protocols tls1.2 tls1.3
    ciphers TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256
}

(LOG) {
    log {
        output file &quot;{args.0}&quot; {
                roll_size     500MiB
                roll_local_time
                roll_keep     20
                roll_keep_for 30d
        }
    }
}


(HSTS) {
   # HSTS (æœ€å¤§æ—¶é•¿63072000 seconds)
    header / Strict-Transport-Security &quot;max-age=63072000&quot;
}

(ERROR_HANDLE) {
        handle_errors {
                @404 {
                        expression {http.error.status_code} == 404
                }
                handle @404 {
                        rewrite * /404.html
                        file_server
                }
        }
}

(GENERAL_CONFIG) {
     # ä½¿ç”¨HTTPéªŒè¯æˆ–TLS-ALPNéªŒè¯
        tls xxxxxx@xxx.com {
            import TLS_CONFIG    
        }
        # HSTS
        import HSTS
        # å‹ç¼©æ”¯æŒ
        encode zstd gzip
        # é”™è¯¯å¤„ç†
        import ERROR_HANDLE
}

{
        servers :443 {
                protocol {
                                experimental_http3
                } 
        }
}

example.com {
        # Set this path to your site's directory.
        root * /root/deploy #æ›¿æ¢ä¸ºä½ éœ€è¦å‘å¸ƒçš„æ–‡ä»¶è·¯å¾„
        file_server
        import LOG &quot;/root/deploy/logs/example.com.log&quot; #æ›¿æ¢ä¸ºä½ éœ€è¦çš„æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶å
        import GENERAL_CONFIG
}
# å¼•å…¥å…¶ä»–çš„ç«™ç‚¹é…ç½®
import /etc/caddy/*.caddy
</code></pre>
<h2 id="å¯åŠ¨ä¸è¿è¡Œ">å¯åŠ¨ä¸è¿è¡Œ</h2>
<p>é¦–å…ˆä½¿ç”¨<code>caddy validate</code>å‘½ä»¤ï¼ŒéªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•æœ‰æ— é”™è¯¯ã€‚</p>
<pre><code class="language-shell">caddy validate --config /etc/caddy/Caddyfile
</code></pre>
<p>åœæ­¢å¹¶é‡æ–°å¯åŠ¨caddy</p>
<pre><code class="language-shell">caddy stop
caddy start
</code></pre>
<p>æˆ–è€…</p>
<pre><code class="language-shell">caddy reload --config /etc/caddy/Caddyfile
</code></pre>
<p>å°†é™æ€ç½‘ç«™å†…å®¹ä¸Šä¼ è‡³å‘å¸ƒç›®å½•ï¼Œé…ç½®é˜²ç«å¢™ç«¯å£æ”¾è¡Œåï¼Œç½‘ç«™åº”è¯¥å°±å¯ä»¥è®¿é—®äº†ã€‚</p>

        </div>

        <!-- copyright -->
        <div class="copyright">
          <div class="container">
            <p><small class="text-gray-400">
                The copyright of the articles on this website is owned by me. Without consent, it is not allowed to copy without permission. Reasonable reprints are welcome to indicate the source of the quotation. Please leave a message for reprinting pictures. The content of the article is only used for technical research and exploration, and shall not be used for illegal purposes.
             </small></p>
          </div>
        </div>

        <div class="text-center text-gray-300">
          
          <span id="/post/Caddy2-installation-hosting-of-static-blogs/" class="leancloud_visitors views-counter meta-info">
            <a class="text-center">ğŸ“‹é˜…è¯»é‡:</a>
            <span id="twikoo_visitors">0</span>
          </span>
          
        </div>
      </div>

      

      
        <button type="button" class="collapsible">
          <i class="ri-message-2-line"></i>
        </button>
        <div class="tcomment rounded-lg px-4 py-4">
          <div id="tcomment"></div>
        </div>  
      

      <footer class="py-12 text-center px-4 md:px-0" v-pre>
  <a href="/atom.xml" target="_blank">RSS
</a> | Powered by <a href="https://github.com/getgridea/gridea" 
target="_blank">Gridea</a> &nbsp;&nbsp;
<br>
Â©2020 Wherelse All Right Reserved 
</footer>

    </div>


    <!-- TOC Container -->
    <div id="toc"
      class="fixed right-0 bottom-0 mb-20 mr-6 shadow w-12 h-12 rounded-lg flex justify-center items-center z-10 cursor-pointer bg-white dark:bg-gray-500 dark:text-gray-200 hover:shadow-lg transition-all animated fadeInRight"
      @click="showToc = true">
      <i class="ri-menu-line font-bold"></i>
    </div>

    <div
      class="fixed right-0 top-0 bottom-0 overflow-y-auto w-64 rounded-lg p-4 m-4  shadow-md bg-white dark:bg-gray-800 p-4 border-l border-gray-100 dark:border-gray-600 z-10 transition-fast"
      :class="{ '-mr-64': !showToc }">
      <div class="flex mb-4 justify-end">
        <div
          class="w-8 h-8 inline-flex justify-center items-center rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-fast"
          @click="showToc = false">
          <i class="ri-close-circle-fill"></i>
        </div>
      </div>
      <div class="post-toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#caddy2%E5%AE%89%E8%A3%85">Caddy2å®‰è£…</a>
<ul>
<li><a href="#%E6%BA%90%E5%AE%89%E8%A3%85%E6%8E%A8%E8%8D%90">æºå®‰è£…(æ¨è)</a></li>
<li><a href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%B9%B6%E6%89%8B%E5%8A%A8%E6%B3%A8%E5%86%8Clinux-service">ä¸‹è½½å®‰è£…å¹¶æ‰‹åŠ¨æ³¨å†Œlinux service</a></li>
</ul>
</li>
<li><a href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">ç¼–è¾‘é…ç½®æ–‡ä»¶</a>
<ul>
<li><a href="#auto-https">Auto-HTTPS</a></li>
<li><a href="#http%E9%AA%8C%E8%AF%81%E4%B8%8Etls-alpn%E9%AA%8C%E8%AF%81">HTTPéªŒè¯ä¸TLS-ALPNéªŒè¯</a></li>
<li><a href="#dns-%E9%AA%8C%E8%AF%81">DNS éªŒè¯</a></li>
</ul>
</li>
<li><a href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E9%85%8D%E7%BD%AE">è¿›ä¸€æ­¥é…ç½®</a></li>
<li><a href="#%E5%AE%8C%E5%96%84%E6%9C%80%E7%BB%88%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">å®Œå–„æœ€ç»ˆé…ç½®æ–‡ä»¶</a></li>
<li><a href="#%E5%90%AF%E5%8A%A8%E4%B8%8E%E8%BF%90%E8%A1%8C">å¯åŠ¨ä¸è¿è¡Œ</a></li>
</ul>
</li>
</ul>
</div>
    </div>

    <!-- Back to top -->
    <div
      class="fixed right-0 bottom-0 mb-4 mr-6 shadow w-12 h-12 rounded-lg flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg transition-all dark:bg-gray-500 dark:text-gray-200"
      @click="backToUp" v-show="scrolled">
      <i class="ri-arrow-up-circle-fill"></i>
    </div>
  </div>

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg">
  </div>
  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
    </div>
    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter">
        </div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip">
        </div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center">
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>-->
  <script src="https://wherelse.cc/media/scripts/vue.min.js"></script>
  <script src="https://wherelse.cc/media/scripts/main.js"></script>

  <!--æ ¹æ®å†…å®¹åŠ¨æ€åŠ è½½-->
  <script type="text/javascript">
    window.onload = function () {
      //æ ¹æ®å†…å®¹åŠ¨æ€åŠ è½½mermiad
      if (document.getElementsByClassName("language-mermaid").length != 0) {
        console.log("find mermaid")
        for (let x of document.getElementsByClassName("language-mermaid")) {
          if (x.nodeName == "CODE") {
            let m = document.createElement("div");
            m.classList.add("mermaid");
            m.textContent = x.textContent;
            x.parentNode.insertAdjacentElement("beforebegin", m);
          }
        }
        let script = document.createElement('script');
        defer = "defer";
        script.src =
          "https://wherelse.cc/media/scripts/mermaid.min.js";
        document.body.append(script);
        script.onload = function () {
          mermaid.initialize({
            startOnLoad: false
          });
          mermaid.init();
          console.log("mermaid init done");
        }
      }

      //bilibili è§†é¢‘æ”¯æŒ
      var content = document.getElementsByClassName("language-bilibili")[0];
      if (content != null) {
        var m = document.createElement("div");
        m.classList.add("bilibili-video");
        m.innerHTML = content.textContent;
        content.parentNode.insertAdjacentElement("beforeend", m);
      }
      //katexè‡ªé€‚åº”åŠ è½½
      if (document.getElementsByClassName("katex").length != 0) {
        let script = document.createElement('script');
        script.defer = "defer"
        script.src =
          "https://wherelse.cc/media/scripts/katex.min.js";
        document.body.append(script);
        script = document.createElement('script');
        script.defer = "defer"
        script.src =
          "https://wherelse.cc/media/scripts/copy-tex.min.js";
        document.body.append(script);
        let link = document.createElement('link');
        link.rel = 'stylesheet';
        link.defer = "defer"
        link.href =
          "https://wherelse.cc/media/css/katex.min.css";
        document.body.append(link);
        link = document.createElement('link');
        link.rel = 'stylesheet';
        link.defer = "defer"
        link.href =
          "https://wherelse.cc/media/css/copy-tex.css";
        document.body.append(link);
      }

      script = document.createElement('script');
      script.defer = "defer"
      script.src =
        "https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js";
      document.body.append(script);
      script.onload = function () {
        let scripts = document.createElement('script');
        scripts.append(document.createTextNode(
          " twikoo.init({envId: \"https://twikoo.vlieo.com\",el: \"#tcomment\",});"));
        var parentDiv = document.getElementById("toc").parentNode;
        var sp = document.getElementById("toc");
        parentDiv.insertBefore(scripts, sp);
      }
    }
  </script>
  <script>
    comment_collapse();
  </script>

 <script>
    //æ‹¿åˆ°é¢„è§ˆæ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„htmlä»£ç 
    var pswpElement = document.querySelectorAll(".pswp")[0];
    //å®šä¹‰å›¾ç‰‡æ•°ç»„å˜é‡
    var imgitems;
    /**
     * ç”¨äºæ˜¾ç¤ºé¢„è§ˆç•Œé¢
     * @param index å›¾ç‰‡æ•°ç»„ä¸‹æ ‡
     */
    function viewImg(index) {
      //å…¶å®ƒé€‰é¡¹è¿™é‡Œä¸åšè¿‡å¤šé˜è¿°ï¼Œè¯¦æƒ…è§å®˜ç½‘
      var pswpoptions = {
        index: parseInt(index, 10), // å¼€å§‹å¹»ç¯ç‰‡ç´¢å¼•ã€‚0æ˜¯ç¬¬ä¸€å¼ å¹»ç¯ç‰‡ã€‚å¿…é¡»æ˜¯æ•´æ•°ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚
        bgOpacity: 0.7, // èƒŒæ™¯é€æ˜åº¦ï¼Œ0-1
        maxSpreadZoom: 3, // ç¼©æ”¾çº§åˆ«ï¼Œä¸è¦å¤ªå¤§
      };
      //åˆå§‹åŒ–å¹¶æ‰“å¼€PhotoSwipeï¼ŒpswpElementå¯¹åº”ä¸Šé¢é¢„è§ˆæ¡†æ¶ï¼ŒPhotoSwipeUI_Defaultä¸ºçš®è‚¤ï¼Œimgitemsä¸ºå›¾ç‰‡æ•°ç»„ï¼Œpswpoptionsä¸ºé€‰é¡¹
      var gallery = new PhotoSwipe(
        pswpElement,
        PhotoSwipeUI_Default,
        imgitems,
        pswpoptions
      );
      gallery.init();
    }
    /**
     * ç”¨äºæ·»åŠ å›¾ç‰‡ç‚¹å‡»äº‹ä»¶
     * @param img å›¾ç‰‡å…ƒç´ 
     * @param index æ‰€å±ä¸‹æ ‡ï¼ˆåœ¨imgitemsä¸­çš„ä½ç½®ï¼‰
     */
    function addImgClick(img, index) {
      img.onclick = function () {
        viewImg(index);
      };
    }
    /**
     * è½®è¯¢æ‰€æœ‰å›¾ç‰‡ï¼Œè·å–srcã€widthã€heightç­‰æ•°æ®ï¼ŒåŠ å…¥imgitemsï¼Œå¹¶ç»™å›¾ç‰‡å…ƒç´ æ·»åŠ äº‹ä»¶
     * æœ€å¥½åœ¨onloadä¸­æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œæœ¬ç«™å› æ”¾åœ¨æœ€åº•éƒ¨ï¼Œæ‰€ä»¥ç›´æ¥åˆå§‹åŒ–
     * å¼‚æ­¥åŠ è½½å›¾ç‰‡å¯åœ¨å›¾ç‰‡å…ƒç´ åˆ›å»ºå®Œæˆåè°ƒç”¨æ­¤æ–¹æ³•
     */
    function initImg() {
      //é‡ç½®å›¾ç‰‡æ•°ç»„
      imgitems = [];
      //æŸ¥æ‰¾class:markdown ä¸‹çš„æ‰€æœ‰imgå…ƒç´ å¹¶éå†
      var imgs = document.querySelectorAll(".markdown img");
      for (var i = 0; i < imgs.length; i++) {
        var img = imgs[i];
        //æœ¬ç«™ç›¸å†Œåˆå§‹ä¸ºloadingå›¾ç‰‡ï¼ŒçœŸå®å›¾ç‰‡æ”¾åœ¨data-src
        var ds = img.getAttribute("src");
        //åˆ›å»ºimageå¯¹è±¡ï¼Œç”¨äºè·å–å›¾ç‰‡å®½é«˜
        var imgtemp = new Image();
        //åˆ¤æ–­æ˜¯å¦å­˜åœ¨data-src
        if (ds != null && ds.length > 0) {
          imgtemp.src = ds;
        } else {
          imgtemp.src = img.src;
        }
        //åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¼“å­˜
        if (imgtemp.complete) {
          var imgobj = {
            src: imgtemp.src,
            w: imgtemp.width,
            h: imgtemp.height,
          };
          imgitems[i] = imgobj;
          addImgClick(img, i);
        } else {
          // console.log("è¿›æ¥äº†2");
          imgtemp.index = i;
          imgtemp.img = img;
          imgtemp.onload = function () {
            var imgobj = {
              src: this.src,
              w: this.width,
              h: this.height,
            };
            //ä¸è¦ä½¿ç”¨pushï¼Œå› ä¸ºonloadå‰åé¡ºåºä¼šä¸åŒ
            imgitems[this.index] = imgobj;
            //æ·»åŠ ç‚¹å‡»äº‹ä»¶
            addImgClick(this.img, this.index);
          };
        }
      }
    }
    //åˆå§‹åŒ–
    initImg();
  </script>
</body>

</html>